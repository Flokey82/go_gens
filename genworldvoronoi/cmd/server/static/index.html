<html>

<head>
  <link rel="stylesheet" href="vendor/leaflet-1.9.3/leaflet.css" />
  <style>
    html,
    body,
    #map {
      width: 100%;
      height: 100%;
      padding: 0;
      margin: 0;
    }

    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script src="vendor/leaflet-1.9.3/leaflet.js"></script>
  <script src="vendor/leaflet-hash-0.2.1/leaflet-hash.js"></script>
  <script type="text/javascript">

    var map = L.map('map', {
      crs: L.CRS.EPSG3857,
    }).setView([0, 0], 1);

    new L.Hash(map);

    L.tileLayer('tiles/{z}/{x}/{y}', {
      attribution: '&copy;',
      maxZoom: 20,
      minZoom: 1,
      tms: true,
    }).addTo(map);

    var layerGroup = L.layerGroup().addTo(map);

    var geojsonLayer = L.geoJSON().addTo(map);
    geojsonLayer.addTo(map);

    var loadGeoJSON = function (url, options) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url);
      xhr.onload = function () {
        if (xhr.status === 200) {
          // First clear the geojson layer
          geojsonLayer.clearLayers();
          var geojson = JSON.parse(xhr.responseText);
          L.geoJSON(geojson, options).addTo(geojsonLayer);
        } else {
          console.log('Error: ' + xhr.status);
        }
      };
      xhr.send();
    };

    // Load the geojson layer when we load a tile
    map.on('moveend', function () {
      var bounds = map.getBounds();
      var zoom = map.getZoom();
      var url = 'geojson/' + zoom + '/' + bounds.getNorth() + '/' + bounds.getWest() + '/' + bounds.getSouth() + '/' + bounds.getEast();
      loadGeoJSON(url, {
        onEachFeature: function (feature, layer) {
          layer.bindPopup('Name: ' + feature.properties.name + '<br/>Type: ' + feature.properties.type + '<br/>Culture: ' + feature.properties.culture);
        }
      });
    });

  </script>
</body>

</html>